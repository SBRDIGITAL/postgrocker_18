# Docker Compose файл для запуска контейнера PostgreSQL 18
services:
  postgrocker_18:
    container_name: postgrocker_18
    image: postgres:18
    env_file:
      - .env
    environment:
      POSTGRES_INITDB_ARGS: "--auth=scram-sha-256"
      TZ: UTC
    volumes:
      # Данные: именованный volume (надёжнее на Windows, чем bind)
      - postgrocker_data:/var/lib/postgresql
      # Логи: отдельный каталог на хосте
      - ./db_logs:/var/log/postgresql
      # Конфигурации: один источник правды — postgresql.conf и pg_hba.conf
      - ./postgresql.conf:/etc/postgresql/postgresql.conf:ro
      - ./pg_hba.conf:/etc/postgresql/pg_hba.conf:ro
    command: ["postgres", "-c", "config_file=/etc/postgresql/postgresql.conf"]
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U ${POSTGRES_USER} -d ${POSTGRES_DB}"]
      interval: 15s
      timeout: 5s
      retries: 5
    restart: unless-stopped
    ports:
      - "127.0.0.1:${POSTGRES_PORT:-5435}:5432"
    networks:
      - postgrocker_network


# Сеть для контейнера Postgrocker 18
networks:
  postgrocker_network:
    driver: bridge

# Именованный volume для данных Postgrocker 18 (персистентные данные)
volumes:
  postgrocker_data: